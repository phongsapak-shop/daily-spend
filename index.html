<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Scanner</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: system-ui, sans-serif; background:#f5f5f5; padding:20px }
    h1 { font-size:24px }
    .card { background:white; border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 4px 10px rgba(0,0,0,.05) }
    input, button { width:100%; padding:10px; margin-top:8px; font-size:16px }
    button { background:#2563eb; color:white; border:none; border-radius:8px }
    table { width:100%; border-collapse:collapse; margin-top:10px }
    th, td { padding:8px; border-bottom:1px solid #ddd; text-align:left }
  </style>
</head>
<body>

<h1>üì∑ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</h1>

<div class="card">
  <h3>‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</h3>
  <div id="reader"></div>
</div>

<div class="card">
  <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
  <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" />
  <input id="price" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)" />
  <button onclick="saveItem()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</button>
</div>

<div class="card">
  <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
  <table>
    <thead><tr><th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th></tr></thead>
    <tbody id="list"></tbody>
  </table>
  <h3 id="total">‡∏£‡∏ß‡∏°: 0 ‡∏ö‡∏≤‡∏ó</h3>
</div>

<script>
let scannedBarcode = null;
let items = JSON.parse(localStorage.getItem('items') || '[]');

function render() {
  const list = document.getElementById('list');
  list.innerHTML = '';
  let sum = 0;
  items.forEach(i => {
    sum += i.price;
    list.innerHTML += `<tr><td>${i.name}</td><td>${i.price}</td></tr>`;
  });
  document.getElementById('total').innerText = `‡∏£‡∏ß‡∏°: ${sum} ‡∏ö‡∏≤‡∏ó`;
  localStorage.setItem('items', JSON.stringify(items));
}

function saveItem() {
  const name = document.getElementById('name').value;
  const price = Number(document.getElementById('price').value);
  if (!name || !price) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
  items.push({ name, price, date: new Date() });
  document.getElementById('name').value = '';
  document.getElementById('price').value = '';
  render();
}

function onScanSuccess(code) {
  scannedBarcode = code;
  fetch(`https://world.openfoodfacts.org/api/v0/product/${code}.json`)
    .then(r => r.json())
    .then(d => {
      if (d.product) {
        document.getElementById('name').value = d.product.product_name || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠';
      } else {
        document.getElementById('name').value = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
      }
    });
}

new Html5Qrcode('reader').start(
  { facingMode: 'environment' },
  { fps: 10, qrbox: 250 },
  onScanSuccess
);

render();
</script>

</body>
</html>
